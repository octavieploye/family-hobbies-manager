<!-- subscription-list.component.html -->
<div class="subscription-list">
  <h1 class="subscription-list__title">Mes inscriptions</h1>

  <!-- Status Filter -->
  <div class="subscription-list__filter">
    <mat-form-field appearance="outline">
      <mat-label>Filtrer par statut</mat-label>
      <mat-select [formControl]="statusFilter">
        <mat-option [value]="null">Tous</mat-option>
        @for (status of statusOptions; track status) {
          <mat-option [value]="status">{{ getStatusLabel(status) }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Loading -->
  @if (loading$ | async) {
    <div class="subscription-list__loading">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Chargement des inscriptions...</p>
    </div>
  } @else {
    <!-- Error -->
    @if (error$ | async; as error) {
      <div class="subscription-list__error" role="alert">
        <mat-icon>error_outline</mat-icon>
        <p>{{ error }}</p>
      </div>
    }

    <!-- Table -->
    @if ((subscriptions$ | async); as subscriptions) {
      @if (subscriptions.length === 0) {
        <div class="subscription-list__empty">
          <mat-icon>inbox</mat-icon>
          <p>Aucune inscription trouv&eacute;e.</p>
        </div>
      } @else {
        <table mat-table [dataSource]="subscriptions" class="subscription-list__table">
          <!-- Activity Name Column -->
          <ng-container matColumnDef="activityName">
            <th mat-header-cell *matHeaderCellDef>Activit&eacute;</th>
            <td mat-cell *matCellDef="let sub">{{ sub.activityName }}</td>
          </ng-container>

          <!-- Association Name Column -->
          <ng-container matColumnDef="associationName">
            <th mat-header-cell *matHeaderCellDef>Association</th>
            <td mat-cell *matCellDef="let sub">{{ sub.associationName }}</td>
          </ng-container>

          <!-- Member Name Column -->
          <ng-container matColumnDef="memberName">
            <th mat-header-cell *matHeaderCellDef>Membre</th>
            <td mat-cell *matCellDef="let sub">{{ sub.memberFirstName }} {{ sub.memberLastName }}</td>
          </ng-container>

          <!-- Subscription Type Column -->
          <ng-container matColumnDef="subscriptionType">
            <th mat-header-cell *matHeaderCellDef>Type</th>
            <td mat-cell *matCellDef="let sub">{{ getTypeLabel(sub.subscriptionType) }}</td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Statut</th>
            <td mat-cell *matCellDef="let sub">
              <mat-chip-set>
                <mat-chip [color]="getStatusColor(sub.status)" highlighted>
                  {{ getStatusLabel(sub.status) }}
                </mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <!-- Start Date Column -->
          <ng-container matColumnDef="startDate">
            <th mat-header-cell *matHeaderCellDef>Date de d&eacute;but</th>
            <td mat-cell *matCellDef="let sub">{{ sub.startDate }}</td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let sub">
              @if (canCancel(sub)) {
                <button
                  mat-icon-button
                  color="warn"
                  (click)="onCancel(sub)"
                  aria-label="Annuler l'inscription"
                >
                  <mat-icon>cancel</mat-icon>
                </button>
              }
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      }
    }
  }
</div>
