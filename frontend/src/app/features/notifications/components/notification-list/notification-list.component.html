<!-- frontend/src/app/features/notifications/components/notification-list/notification-list.component.html -->
<mat-card class="notification-list">
  <mat-card-header>
    <mat-card-title>Mes notifications</mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <!-- Loading -->
    @if (loading()) {
      <div class="notification-list__loading">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    }

    <!-- Error -->
    @if (error(); as errorMsg) {
      <div class="notification-list__error">
        <mat-icon color="warn">error</mat-icon>
        <span>{{ errorMsg }}</span>
      </div>
    }

    <!-- Table -->
    @if (!loading() && !error()) {
      @if (notifications().length === 0) {
        <div class="notification-list__empty">
          <mat-icon>notifications_none</mat-icon>
          <p>Aucune notification</p>
        </div>
      } @else {
        <table mat-table [dataSource]="notifications()" class="notification-list__table">
          <!-- Read status column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let notification">
              @if (!notification.read) {
                <span class="notification-list__unread-dot"></span>
              }
            </td>
          </ng-container>

          <!-- Category column -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Categorie</th>
            <td mat-cell *matCellDef="let notification">
              <mat-chip-set>
                <mat-chip>{{ getCategoryLabel(notification.category) }}</mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <!-- Title column -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef>Titre</th>
            <td mat-cell *matCellDef="let notification">
              {{ notification.title }}
            </td>
          </ng-container>

          <!-- Message column -->
          <ng-container matColumnDef="message">
            <th mat-header-cell *matHeaderCellDef>Message</th>
            <td mat-cell *matCellDef="let notification">
              {{ notification.message }}
            </td>
          </ng-container>

          <!-- Date column -->
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Date</th>
            <td mat-cell *matCellDef="let notification">
              {{ notification.createdAt | date:'short' }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="notification-list__row"
            [class.notification-list__row--unread]="!row.read"
            (click)="onNotificationClick(row)"
          ></tr>
        </table>

        <mat-paginator
          [length]="pagination().totalElements"
          [pageIndex]="pagination().currentPage"
          [pageSize]="pagination().pageSize"
          [pageSizeOptions]="[5, 10, 25]"
          (page)="onPageChange($event)"
        ></mat-paginator>
      }
    }
  </mat-card-content>
</mat-card>
